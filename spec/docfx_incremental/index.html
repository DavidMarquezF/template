
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="conceptual" content="<p>This documentation describes the implementation of incrementally extracting metadata from source. Currently we are using <em>Roslyn</em> to compile and analyse source code on the fly. When input sources are large, it may take minutes to load and process the files. To speed up the extraction, previous extracted details are saved to cache for further reference.</p>
<p>There are two level caches in current implementation. First one is called <em>Application</em> Level cache, and the other one is <em>Project</em> level cache.</p>
<p><em>Application</em> level cache is saved in file <code>%LocalAppData%/xdoc/cache</code>.</p>
<p>For <em>Project</em> level cache,</p>
<p>a. If input sources are supported project files, e.g. <code>.csproj</code> or <code>.vbproj</code> files, <em>Project</em> level cache is located in file <code>obj/xdoc/.cache</code> under the same folder of the project file.</p>
<p>b. If input sources are supported source code files, e.g. <code>.cs</code> or <code>.vb</code> files, <em>Project</em> level cache is located in file <code>obj/xdoc/.cache</code> under the same folder of the alphabetically first source code file.</p>
<p>The cache file contains key-value pairs saved in <em>JSON</em> format. The key is the normalized input source code files, and the data structure for the value is as below:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TriggeredUTCTime</td>
<td>The UTC time when the action is triggered</td>
</tr>
<tr>
<td>CompletedUTCTime</td>
<td>The UTC time when the action is completed</td>
</tr>
<tr>
<td>OutputFolder</td>
<td>The output folder for the extracted result</td>
</tr>
<tr>
<td>RelativeOutputFiles</td>
<td>The paths of the extracted results related to the <em>OutputFolder</em></td>
</tr>
<tr>
<td>CheckSum</td>
<td>The MD5 checksum calculated for all the extracted results</td>
</tr>
</tbody>
</table>
<p>Detailed Steps are described below:</p>
<ol>
<li><p>For each input solution/project/source files, get most latest <code>LastModifiedTime</code>.
a. For solution, get <code>LastModifiedTime</code> for the solution file, and containing projects
b. For project, get <code>LastModifiedTime</code> for the project file, project references, assembly references and containing documents.
c. For source files, get <code>LastModifiedTime</code> for the files</p>
</li>
<li><p>Normalize project list, check if <em>Application</em> level cache for these project list exists. Compare <code>TriggeredUTCTime</code> with the <code>LastModifiedTime</code> fetched in #1, and check if checksum remains unchanged for output files. If is, copy result files to output folder. Otherwise, continue to #3.</p>
</li>
<li><p>For each supported solution/project/source code files,</p>
<p><em>Step 1</em>. Check if <em>Project</em> level cache exists. If not, go to <em>Step 4</em>.</p>
<p><em>Step 2</em>. Compare <code>TriggeredUTCTime</code> with the <code>LastModifiedTime</code> fetched in #1, and check if checksum remains unchanged for output files. If not, go to <em>Step 3</em>.</p>
<p><em>Step 3</em>. Generate YAML metadata for current project and save to <em>Project</em> level cache.</p>
</li>
<li><p>Read YAML metadata for each project, and merge with others following rules below:</p>
<p><em>Rule 1</em>. For <code>namespace</code>, if <code>uid</code> equals, <strong>append</strong>.</p>
<p><em>Rule 2</em>. For other type, if <code>uid</code> equals, <strong>override</strong>.</p>
</li>
<li><p>Save result, and update *<em>Application</em> level cache.</p>
</li>
</ol>
" />
<meta name="depot_name" content="." />
<meta name="document_id" content="07688668-0f27-2818-2cfa-5fdc657d3bc2" />
<meta name="document_version_independent_id" content="0f483b5b-1c9a-7396-ec78-b8aa15f0fc07" />
<meta name="gitcommit" content="https://github.com/docascode/template/blob/b800b502012fd6e3c03390528278ff13ccbdfca9/samples/spec/docfx_incremental.md" />
<meta name="locale" content="en-us" />
<meta name="menu_path" content="/menu.json" />
<meta name="original_content_git_url" content="https://github.com/docascode/template/blob/feature/ghpage/samples/spec/docfx_incremental.md" />
<meta name="rawTitle" content="<h1 id=&quot;doc-as-code-docfxexe-incremental-build-specification&quot;>Doc-as-code: DocFx.exe Incremental Build Specification</h1>" />
<meta name="schema" content="Conceptual" />
<meta name="site_name" content="Docs" />
<meta name="updated_at" content="2021-06-02 06:23 AM" />
<meta name="wordCount" content="420" />


	<title>Doc-as-code: DocFx.exe Incremental Build Specification</title>

	<link rel="stylesheet" href="/dist/docfx.css">

	<script type="text/javascript" src="/styles/docfx.vendor.js"></script>
	<script type="text/javascript" src="/dist/docfx.js"></script>
</head>

<body data-spy="scroll" data-target="#affix">
	<div id="wrapper">
		<header>
<nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
<a class="navbar-brand" href="/">
  <img id="logo" class="svg" src="/svg/logo.svg">
</a>
    </div>
    <div class="collapse navbar-collapse" id="navbar">
      <form class="navbar-form navbar-right" role="search" id="search">
        <div class="form-group">
          <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
        </div>
      </form>
      <div class="switch-theme" title="Switch Theme">
        <img class="svg hidden light-entrance" src="/svg/sun.svg">
        <img class="svg hidden dark-entrance" src="/svg/moon.svg">
      </div>
    </div>
  </div>
</nav>

<div class="subnav navbar navbar-default">
  <div class="container hide-when-search" id="breadcrumb">
    <ul class="breadcrumb">
      <li></li>
    </ul>
  </div>
</div>
		</header>

		<div role="main" class="container body-content page-type-conceptual">
<div class="sidenav hide-when-search">
  <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
  <div class="sidetoggle collapse" id="sidetoggle">
    <div id="sidetoc"></div>
  </div>
</div>
			<div class="article row grid-right">

				<div class="col-md-10">

					<article class="content wrap" id="_content" data-uid="">
						<h1 id="doc-as-code-docfxexe-incremental-build-specification">Doc-as-code: DocFx.exe Incremental Build Specification</h1>
<ul class="metabar">
  <li>
    <time datetime="6/2/2021">6/2/2021</time>
  </li>
  <li class="readingTime">2 minutes to read</li>
</ul>						<p>This documentation describes the implementation of incrementally extracting metadata from source. Currently we are using <em>Roslyn</em> to compile and analyse source code on the fly. When input sources are large, it may take minutes to load and process the files. To speed up the extraction, previous extracted details are saved to cache for further reference.</p>
<p>There are two level caches in current implementation. First one is called <em>Application</em> Level cache, and the other one is <em>Project</em> level cache.</p>
<p><em>Application</em> level cache is saved in file <code>%LocalAppData%/xdoc/cache</code>.</p>
<p>For <em>Project</em> level cache,</p>
<p>a. If input sources are supported project files, e.g. <code>.csproj</code> or <code>.vbproj</code> files, <em>Project</em> level cache is located in file <code>obj/xdoc/.cache</code> under the same folder of the project file.</p>
<p>b. If input sources are supported source code files, e.g. <code>.cs</code> or <code>.vb</code> files, <em>Project</em> level cache is located in file <code>obj/xdoc/.cache</code> under the same folder of the alphabetically first source code file.</p>
<p>The cache file contains key-value pairs saved in <em>JSON</em> format. The key is the normalized input source code files, and the data structure for the value is as below:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>TriggeredUTCTime</td>
<td>The UTC time when the action is triggered</td>
</tr>
<tr>
<td>CompletedUTCTime</td>
<td>The UTC time when the action is completed</td>
</tr>
<tr>
<td>OutputFolder</td>
<td>The output folder for the extracted result</td>
</tr>
<tr>
<td>RelativeOutputFiles</td>
<td>The paths of the extracted results related to the <em>OutputFolder</em></td>
</tr>
<tr>
<td>CheckSum</td>
<td>The MD5 checksum calculated for all the extracted results</td>
</tr>
</tbody>
</table>
<p>Detailed Steps are described below:</p>
<ol>
<li><p>For each input solution/project/source files, get most latest <code>LastModifiedTime</code>.
a. For solution, get <code>LastModifiedTime</code> for the solution file, and containing projects
b. For project, get <code>LastModifiedTime</code> for the project file, project references, assembly references and containing documents.
c. For source files, get <code>LastModifiedTime</code> for the files</p>
</li>
<li><p>Normalize project list, check if <em>Application</em> level cache for these project list exists. Compare <code>TriggeredUTCTime</code> with the <code>LastModifiedTime</code> fetched in #1, and check if checksum remains unchanged for output files. If is, copy result files to output folder. Otherwise, continue to #3.</p>
</li>
<li><p>For each supported solution/project/source code files,</p>
<p><em>Step 1</em>. Check if <em>Project</em> level cache exists. If not, go to <em>Step 4</em>.</p>
<p><em>Step 2</em>. Compare <code>TriggeredUTCTime</code> with the <code>LastModifiedTime</code> fetched in #1, and check if checksum remains unchanged for output files. If not, go to <em>Step 3</em>.</p>
<p><em>Step 3</em>. Generate YAML metadata for current project and save to <em>Project</em> level cache.</p>
</li>
<li><p>Read YAML metadata for each project, and merge with others following rules below:</p>
<p><em>Rule 1</em>. For <code>namespace</code>, if <code>uid</code> equals, <strong>append</strong>.</p>
<p><em>Rule 2</em>. For other type, if <code>uid</code> equals, <strong>override</strong>.</p>
</li>
<li><p>Save result, and update *<em>Application</em> level cache.</p>
</li>
</ol>

					</article>

				</div>

<div class="hidden-sm col-md-2" role="complementary">
  <div class="sideaffix">
    <div class="contribution">
      <ul class="nav">
        <li>
          <a href="https://github.com/docascode/template/blob/feature/ghpage/samples/spec/docfx_incremental.md" class="contribution-link">
            <img class="svg" src="/svg/edit.svg">
            <span>Edit this doc</span>
          </a>
        </li>
      </ul>
    </div>
    <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
    </nav>
  </div>
</div>
			</div>
		</div>
<footer>
  <div class="grad-bottom"></div>
  <div class="footer">
    <div class="container">
      <span class="pull-right">
        <a href="#top">Back to top</a>
      </span>
    <span>Copyright © Microsoft.<br>Generated by <strong>DocFX</strong></span>
    </div>
  </div>
</footer>
	</div>
</body>

</html>